find_package(Sphinx REQUIRED)
if (SPHINX_FOUND)

  add_custom_target(manual-html ALL
    COMMAND sphinx-build -d htmldir ${CMAKE_CURRENT_SOURCE_DIR}/manual ${PROJECT_BINARY_DIR}/docs/html/manual
    WORKING_DIRECTORY ${PROJECT_BINARY_DIR})

  install(DIRECTORY ${PROJECT_BINARY_DIR}/docs/html/manual DESTINATION ${CMAKE_INSTALL_PREFIX}/share/ert/docs)

  # This command will configure sphinx to create a LaTeX version of the manual
  # in docs/latex/manual.
  #
  # The LaTeX code generated by sphinx uses some packagages which are not
  # installed on RHEL 6/7, those sty files are therefor bundled with this
  # project and copied manually to the LaTeX directory.
  find_package(LATEX COMPONENTS pdflatex)
  if (PDFLATEX_COMPILER)
    add_custom_target(manual-latex ALL
      COMMAND sphinx-build -b latex -d latexdir ${CMAKE_CURRENT_SOURCE_DIR}/manual ${PROJECT_BINARY_DIR}/docs/latex/manual
      WORKING_DIRECTORY ${PROJECT_BINARY_DIR})

    install(FILES ${PROJECT_BINARY_DIR}/docs/latex/manual/ERT.pdf DESTINATION ${CMAKE_INSTALL_PREFIX}/share/ert/docs)

    file(GLOB sty_files "latex/*.sty")
    file(COPY ${sty_files} DESTINATION ${PROJECT_BINARY_DIR}/docs/latex/manual)

    add_custom_target(manual-pdf ALL
      COMMAND pdflatex "ERT.tex"
      DEPENDS manual-latex
      WORKING_DIRECTORY ${PROJECT_BINARY_DIR}/docs/latex/manual)
  endif()

else()
  message(STATUS "Sphinx documentation tool not found - documentation not generated")
endif()
